# ワークフロー概要

このドキュメントは、Anshinプロジェクトのドキュメントを維持・クリーンアップ・標準化するための自動化ワークフロー（`/anshin/.github/workflows`）について説明します。

---

## 概要

ワークフローはDecap CMSプロセスや`/anshin/scripts`のカスタムスクリプトと密接に統合されています。Decap CMSでドキュメントが追加・編集されると、`stg`から`cms/`で始まる名前の新しいブランチが作成されます。その後、ワークフローがスクリプトを実行し、変更内容をマージする前に必要なインポートやコンポーネントの挿入、サニタイズ、検証を行います。

---

## 1. PRサニタイズ＆フロントマター保証（`pr-sanitize-ensure.yml`）

**実行タイミング:**
- `stg`ブランチへのプルリクエスト時、`cms/`で始まるブランチ（Decap CMSによる作成）。

**処理内容:**
- PRブランチのチェックアウト。
- 依存関係のインストール。
- 変更されたMarkdownファイル（削除されたファイルは除く）の検出。
- `sanitize-md.js`でMarkdownとフロントマターのクリーンアップ・検証。
- `ensure-frontmatter.js`で必須フィールドと順序の保証。
- 変更内容をPRブランチにコミット＆プッシュ。

**目的:**
- PR内のすべてのMarkdownファイルがクリーンで安全、かつ有効なフロントマターを持つことを保証します。

---

## 2. マージ後クリーンアップ（`post-merge-cleanup.yml`）

**実行タイミング:**
- `stg`へのプルリクエストがクローズ＆マージされたとき、`cms/`で始まるブランチ。

**処理内容:**
- マージ後の`stg`ブランチのチェックアウト。
- 依存関係のインストール。
- マージされたPR内の新規Markdownファイルの検出。
- 新規ファイルへのサイドバー位置割り当て（`assign-sidebar-position.js`）。
- 新規ファイルの自動生成領域クリア（`clear-auto-region.js`）。
- 必要なインポートの挿入（`add-imports.js`）。
- 必要なコンポーネントの挿入（`add-components.js`）。
- 変更内容を`stg`ブランチにコミット＆プッシュ。

**目的:**
- 新しいドキュメントファイルがマージ後に完全に処理・クリーンアップされ、サイドバーに統合されることを保証します。

---

## これらのワークフローの利点
- すべてのドキュメント変更に対してファイルの検証・クリーンアップ・サイドバー管理を自動化。
- 手動ミスを減らし、ドキュメントの一貫性を維持。
- Decap CMSやカスタムスクリプト（`/anshin/scripts`）とシームレスに統合。

---

## 参考
- これらのワークフローで呼び出されるスクリプトの詳細は[スクリプト概要](./scripts-overview-jp.md)をご覧ください。
- Decap CMSの詳細は[Decap CMS Docs](https://decapcms.org/)をご参照ください。
